# README

First do the installation steps down here.

Packages can be compiled by executing the following command from the workspace root:

```
catkin_make -DFranka_DIR:PATH=~/libfranka/build
```

In case the `franka_controller` package is not needed, such as when the application will only be used for running the simulation
the following command can be used from the workspace root:

```
catkin_make -DCATKIN_BLACKLIST_PACKAGES="franka_controller"
```

Unittests for **<u>all</u>** packages can be compiled by executing the following command from the workspace root:

```
catkin_make tests
```

Unittests per package can be run by the following command:
```
rosrun ${PACKAGE_NAME} ${PACKAGE_NAME}_unit_tests
```


Code coverage per package can be generated by executing the following command from the workspace root:

```
catkin_make -DCODE_COVERAGE=1 ${PACKAGE_NAME}_coverage
```

Code coverage results can be found in the following folder:
```
${ROS_WORKSPACE}/build/${PACKAGE_NAME}/${PACKAGE_NAME}_coverage
```
## Kinematics Installation

Franka Panda requires the following library to work:

```
sudo apt install build-essential cmake git libpoco-dev libeigen3-dev
cd ~
git clone --recursive https://github.com/frankaemika/libfranka
cd libfranka
mkdir build
cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
cmake --build .
catkin_make -DFranka_DIR:PATH=~/libfranka/build
```

### Adding libfranka to an executable or library

Edit the Cmakelists:

```
find_package(Boost REQUIRED COMPONENTS system)
find_package(Eigen3 REQUIRED)
find_package(Franka 0.3.0 REQUIRED)
 
include_directories(
  ${catkin_INCLUDE_DIRS}
  SYSTEM ${EIGEN3_INCLUDE_DIRS}
)
 
catkin_package(
  LIBRARIES franka_state_controller franka_control_services
)
```

* If you want to add library to executable

```
target_link_libraries( %executableName% ${catkin_LIBRARIES} ${Franka_LIBRARIES})
```

## Simulation install guide

1. Initialise submodules in this repo:
```
git submodule init
git submodule update
```

2. First install the required libraries:
```
sudo apt install libsdl2-dev
```
Not found error :
```
sudo apt install libSDL2-dev
```
Unmet dependency error:
```
sudo apt-get install aptitude
sudo aptitude install libsdl2-dev
```
3. Clone kinect repo:
```
git clone https://github.com/OpenKinect/libfreenect2.git
cd libfreenect2
sudo apt-get install build-essential cmake pkg-config
sudo apt-get install libusb-1.0-0-dev
sudo apt-get install libturbojpeg0-dev
sudo apt-get install libglfw3-dev
sudo apt-get install libopenni2-dev
```
4. Execute in libfreenect2 root directory:
```
mkdir build && cd build
cmake .. -DCMAKE_INSTALL_PREFIX=$HOME/freenect2
make
make install
```

## Running simulation guide


1. Navigate to catkin workspace and execute:
```
catkin_make
source devel/setup.bash
```
2. Running simulation example
```

roslaunch ${PACKAGE_NAME} ${WORLD_NAME}.launch
``
3. Running simulation
```
roslaunch sim_world world.launch
```
4. Possible launch options

```
 al5d.world
 franka.world
 franka_agv.world
 franka_empty.world
 child_with_lidar.world
current_sim_world.world
```

5. Possible launch arguments

```
all_nodes
paused
verbose    
world 
```
6. Running simulation with argument example
```
roslaunch sim_world world.launch paused:=true
```

## Running real-world application

Terminal 1:

```
roslaunch main_application main.launch
```

Terminal 2:
```
rosrun webcam_driver webcam_driver -<WEBCAM_ID>
```
Example:
```
rosrun webcam_driver webcam_driver -2
```

## Available Packages

| Package               | Description                           |
|-----------------------|---------------------------------------|
| sim_agv               | AGV model plugin                      |
| sim_cup               | cup model plugin                      |
| sim_kinect            | kinect model plugin                   |
| sim_lidar             | lidar model plugin                    |
| sim_robot             | cup model plugin                      |
| sim_sonar             | sonar model plugin                    |
| [gazebo_grasp_plugin] | Plugin which helps grasping in Gazebo |

Every package has its own README for further instructions
